/*C*****************************************************************************
* FILE_NAME         : main.c                                             
*----------------------------------------------------------------------------
* FILE_CREATED_BY   : BERTHY JS                                             
* FILE_CREATION_DATE: 4/05/00                                              
*----------------------------------------------------------------------------
* FILE_PURPOSE:    
*
******************************************************************************/
/*_____ I N C L U D E - F I L E S ____________________________________________*/

#include "config.h"
#include "schedule.h"

//#define TIMER2_2ms (0xFFFF - (2000*FOSC)/12000) 
#define TIMER2_2ms   (0xFFFF - 2000) 

/*_____ G L O B A L S ________________________________________________________*/


/*_____ P R I V A T E - F U N C T I O N S - D E C L A R A T I O N ____________*/

void init_timer2(void);

/*_____ L O C A L S __________________________________________________________*/




/*F**************************************************************************
* FUNCTION_NAME: main                                             
*-------------------------------------------------------------------------
* FUNCTION_AUTHOR: BERTHY J.S.                                              
* FUNCTION_DATE  : 4/05/00                                                 
*----------------------------------------------------------------------------
* FUNCTION_PURPOSE:                          
* FUNCTION_INPUTS : void
* FUNCTION_OUTPUTS: void                                                                                                                 
******************************************************************************/
void main (void)
{
 	P0 = 0xFF;
 	P1 = 0xFF;
  init_timer2();

  EA = 1;

  schedule_init();
  
  while(1)
  {
		P1_0 = ~P1_0;
 
 	  schedule();
  }
}


/*F**************************************************************************
* FUNCTION_NAME: init_timer_2                                            
*-------------------------------------------------------------------------
* FUNCTION_AUTHOR: BERTHY J.S.                                              
* FUNCTION_DATE  : 4/05/00                                                 
*----------------------------------------------------------------------------
* FUNCTION_PURPOSE:                          
* FUNCTION_INPUT
* FUNCTION_OUTPUTS: void                                                                                                                 
******************************************************************************/
void init_timer2(void)
{
/* 16 bit auto reload mode */
/*-------------------------*/
  T2CON = 0;

  TH2 = 0;
  TL2 = 0;
  RCAP2L = LOW(TIMER2_2ms);
  RCAP2H = HIGH(TIMER2_2ms);

/* enable timer 2 interrupt. */
/*---------------------------*/
  ET2 = 1;

/* run timer 2. */
/*--------------*/
  TR2 = 1;
}

/*F**************************************************************************
* FUNCTION_NAME: fct_timer2_it                                            
*-------------------------------------------------------------------------
* FUNCTION_AUTHOR: BERTHY J.S.                                              
* FUNCTION_DATE  : 4/05/00                                                 
*----------------------------------------------------------------------------
* FUNCTION_PURPOSE:                          
* FUNCTION_INPUTS : void
* FUNCTION_OUTPUTS: void                                                                                                                 
******************************************************************************/
Interrupt(fct_timer2_it(void), 5)
{
  TF2 = 0; /* raz flag interrupt. */
  activate_new_schedul();
	P1_1 = ~P1_1;

}


Interrupt(it_7(void), 7)
{
  fct_can_it();
}

